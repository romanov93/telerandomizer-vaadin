# TeleRandomizer

## Список задач:
- [ ] Разбить проект на микросервисы
- [ ] Добавить телеграм бота
- [ ] Исправить допущенные в коде антипаттерны, улучшить архитектуру

## Описание:
0) Telerandomizer - веб-программа, написаная на Java17 с использованием библиотеки Vaadin.
1) Приложение генерирует случайные телефонные номера для проведения телефонных опросов или холодных обзвонов.
2) Перед генерацией случайных номеров, пользователь должен указать регион и город поиска,
а также сколько номеров нужно искать и какой тип номеров нужен (мобильные или стационарные).
3) Для поиска используется реестр открытых данных Министерства цифрового развития Российской Федерации.
4) Найденные номера пользователь может скчать в формате .xl или .csv, или же просмотреть в таблице на странице приложения.
5) Для зарегистрированных пользователей найденные номера сохраняюся в базу данных и не генерируются повторно.
6) Поиском можно пользоваться без регистрации в системе, но в таком случае номера не сохряняются и могут 
генерироваться повторно.

## Как собрать и запустить приложение:
- Перед сборкой jar-файла, нужно убедиться, что в application.yaml подключен продакшн-мод: "vaadin:productionMode: true"
- Приложение собирается в JAR через командную строку: mvnw clean package -Pproduction
- Запускается в Докере, docker-compose файл расположен в корне проекта.

## Библиотеки:
- Vaadin
- Spring Boot
- Spring Security
- Spring DataJPA
- Postgresql
- ApachePOI
- Flyway
- Lombok
- Mapstruct

## Структура проекта:
- В пакете layouts расположены vaadin-классы, определяющие расположение компонентов(текст, поля ввода, кнопки итд...)
на страницах приложения.
- В пакете binders находятся классы, в которых назначаюся события, происходящие при взаимодействии пользователя
с компонентами на страницах приложения.
- Классы в пакете view связывают layouts и binders, а также определяют роутинг страниц и роли пользователей, которым
будет доступен переход на страницу.
- Пакет vaadincomponents содержит классы, унаследованные от базовых vaadin компонентов. Данные классы далее используются
в layouts.
- В пакет filewriters вынесена логика преобразования записей из БД в .csv и .xl файлы.
- Классы пакета csvwork отвечают за работу с .csv файлами с сайта Минцифры, которые содержат диапазоны телефонных номеров.
- Класс MainLayout.java сгенерирован на странице стартера Vaadin. Данный класс определяет вид главной страницы сайта.
- В пакете randomizer находятся классы, отвечающие за генерацию случайных телефонных номеров в рамках существющих диапазонов.

## Алгоритм поиска случайных телефонных номеров:
1) Запрос пользователя (сколько нужно номеров, по какому региону и городу) преобразуется в объект класса UserRequest.
2) Находятся все диапазоны номеров, подходящих под запрос пользователя.
3) Находятся все ранее сгенерированные текущим пользователем номера, которые подходят под данный запрос.
4) Проверяется, есть ли запрашиваемое пользователем количество номеров. Если нет - пользователю выводится сообщение
с количеством доступных номеров.
5) Высчитывается сколько в каждом из найденных диапазов есть номеров, еще не найденных пользователем.
6) В равной пропорции высчитывается сколько нужно найти номеров из каждого диапазона.
7) В каждом диапазоне генерируется нужно количество телефонных номеров.
8) Номера перемешиваются, их список отдается пользователю.

## Полезные ссылки:
- Документация Vaadin: https://vaadin.com/docs
- Ваадин-стартер: https://start.vaadin.com/app/p
- Открытый реестр телефонных диапазонов Минцифры: https://opendata.digital.gov.ru/registry/numeric